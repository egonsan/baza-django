{% extends "sprzet/base.html" %}
{% block content %}

<style>
  .panel {
    border-radius: 12px;
    padding: 25px 30px;
    margin-bottom: 40px;
    width: 100%;
    box-sizing: border-box;

    /* motyw */
    background: var(--panel);
    color: var(--text);
    border: 1px solid var(--panel-border);
    box-shadow: var(--panel-shadow);
  }

  .panel h1 {
    margin: 0 0 18px;
    font-size: 1.6rem;
    font-weight: 700;
    color: var(--text);
  }

  .searchbar {
    display: flex;
    gap: 10px;
    margin: 0 0 18px;
    align-items: center;
    max-width: 520px; /* żeby nie było “rozjechane” */
  }

  .searchbar input[type="text"]{
    flex: 1;
    padding: 10px 12px;
    border-radius: 8px;
    font-size: 0.95rem;
    outline: none;

    background: var(--input-bg);
    color: var(--text);
    border: 1px solid var(--input-border);
  }

  .searchbar button{
    padding: 10px 14px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.95rem;
    font-weight: 600;

    background: var(--btn);
    color: var(--btn-text);
  }
  .searchbar button:hover{
    background: var(--btn-hover);
  }

  table.soft-table {
    width: 100%;
    border-collapse: collapse;

    background: var(--panel);
    color: var(--text);
  }

  table.soft-table th, table.soft-table td {
    padding: 14px 12px;
    text-align: left;
    border-bottom: 1px solid var(--table-row-border);
    font-size: 0.95rem;
    vertical-align: top;
  }

  table.soft-table th {
    background: var(--table-head);
    font-weight: 700;
    color: var(--text);
  }

  .soft-name {
    font-weight: 700;
    color: var(--text);
  }

  .btn-details {
    display: inline-block;
    padding: 6px 12px;
    text-decoration: none;
    border-radius: 6px;
    font-size: 0.85rem;
    transition: background 0.2s;
    white-space: nowrap;

    background: var(--btn);
    color: var(--btn-text);
  }
  .btn-details:hover { background: var(--btn-hover); }

  .labs-wrap { line-height: 1.35; }

  .labs-group {
    margin: 0 0 8px;
    padding: 8px 10px;
    border-radius: 10px;
    border: 1px solid var(--panel-border);
  }

  .labs-group h4{
    margin: 0 0 6px;
    font-size: 0.85rem;
    font-weight: 800;
    letter-spacing: 0.2px;
    color: var(--text);
  }

  /* Lekko różne tła dla grup – zależne od motywu */
  html[data-theme="light"] .bg-b30 { background: #f7fbff; }
  html[data-theme="light"] .bg-b40 { background: #fffaf3; }
  html[data-theme="light"] .bg-inne{ background: #f8f8f8; }

  html[data-theme="dark"] .bg-b30 { background: rgba(47,106,216,0.10); }
  html[data-theme="dark"] .bg-b40 { background: rgba(255,224,179,0.10); }
  html[data-theme="dark"] .bg-inne{ background: rgba(255,255,255,0.06); }

  .lab-btn {
    display: inline-block;
    padding: 6px 10px;
    margin: 4px 6px 0 0;
    border-radius: 999px;
    font-size: 0.85rem;
    text-decoration: none;
    white-space: nowrap;

    background: var(--panel);
    color: var(--text);
    border: 1px solid var(--input-border);
  }

  /* minimalnie inne akcenty */
  .lab-btn.b30 { border-color: rgba(47,106,216,0.45); }
  .lab-btn.b40 { border-color: rgba(255,224,179,0.55); }
  .lab-btn.inne { border-color: rgba(255,255,255,0.25); }

  .empty { color: var(--muted); }
</style>

<div class="panel">
  <h1>Oprogramowanie</h1>

  <form class="searchbar" method="get" action="">
    <input type="text" name="q" placeholder="Szukaj programu…" value="{{ q|default:'' }}">
    <button type="submit">Szukaj</button>
  </form>

  {% if items %}
    <table class="soft-table">
      <thead>
        <tr>
          <th style="width: 35%;">Program</th>
          <th>Laboratoria</th>
          <th style="width: 140px;">Akcja</th>
        </tr>
      </thead>
      <tbody>
        {% for it in items %}
          <tr>
            <td class="soft-name">{{ it.name }}</td>

            <td class="labs-wrap">
              {% with g=it.grouped_labs %}
                {% if g.Budynek_30|length == 0 and g.Budynek_40|length == 0 and g.Inne|length == 0 %}
                  <span class="empty">—</span>
                {% else %}

                  {% if g.Budynek_30|length > 0 %}
                    <div class="labs-group bg-b30">
                      <h4>Budynek 30</h4>
                      {% for lab in g.Budynek_30 %}
                        <a class="lab-btn b30" href="{% url 'educational_software:laboratory_detail' lab %}">{{ lab }}</a>
                      {% endfor %}
                    </div>
                  {% endif %}

                  {% if g.Budynek_40|length > 0 %}
                    <div class="labs-group bg-b40">
                      <h4>Budynek 40</h4>
                      {% for lab in g.Budynek_40 %}
                        <a class="lab-btn b40" href="{% url 'educational_software:laboratory_detail' lab %}">{{ lab }}</a>
                      {% endfor %}
                    </div>
                  {% endif %}

                  {% if g.Inne|length > 0 %}
                    <div class="labs-group bg-inne">
                      <h4>Inne</h4>
                      {% for lab in g.Inne %}
                        <a class="lab-btn inne" href="{% url 'educational_software:laboratory_detail' lab %}">{{ lab }}</a>
                      {% endfor %}
                    </div>
                  {% endif %}

                {% endif %}
              {% endwith %}
            </td>

            <td>
              <a class="btn-details" href="{% url 'educational_software:software_detail' it.id %}">
                Szczegóły
              </a>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="empty">Brak danych o oprogramowaniu. Wykonaj import Excela.</p>
  {% endif %}
</div>

{% endblock %}
